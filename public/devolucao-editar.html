<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Sistema de gerenciamento de devoluções">
  <link rel="shortcut icon" href="assets/img/favicon.png" type="image/x-icon">
  <title>Controle Fácil - Devolução</title>
  <link rel="stylesheet" href="css/devolucao.css">
  
  <style>
    /* Régua de Status */
    .stepper-wrap { display: flex; justify-content: space-between; margin: 0 0 2rem 0; padding: 0 1rem; position: relative; }
    .stepper-wrap::before { content:''; position: absolute; top: 50%; left: 20px; right: 20px; height: 2px; background: #e2e8f0; z-index: 0; transform: translateY(-50%); }
    .step { position: relative; z-index: 1; background: #fff; padding: 0.5rem 1rem; border: 1px solid #e2e8f0; border-radius: 20px; font-size: 0.875rem; font-weight: 500; color: #64748b; }
    .step.active { border-color: var(--primary); color: var(--primary); font-weight: 700; box-shadow: 0 0 0 2px #bfdbfe; }
    
    /* Grid Layout Sidebar + Main */
    @media (min-width: 1024px) {
      .grid-layout { display: grid; grid-template-columns: 320px 1fr; gap: 1.5rem; align-items: start; }
      .area-sidebar { position: sticky; top: 80px; }
    }
    
    /* Estilo de Input "Static" (Parece texto) */
    .input-static { background-color: transparent !important; border: none !important; padding-left: 0 !important; font-weight: 600; color: #334155; cursor: default; }
    .card-static { background-color: #f8fafc; border: 1px solid #e2e8f0; }
    
    /* Badges ML */
    .ml-badge-group { background: #f0f9ff; padding: 10px; border-radius: 8px; border: 1px dashed #bae6fd; margin-top: 8px; }
    .ml-label { font-size: 0.75rem; color: #0284c7; font-weight: 600; display: block; margin-bottom: 4px; }
    
    /* CTA Box */
    .cta-box { background: #f0fdf4; border: 1px solid #bbf7d0; padding: 1.25rem; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; }
  </style>
</head>
<body>
  <div class="devolucao-page">
    <div class="topbar-mini">
      <a href="index.html" class="topbar-back" aria-label="Voltar">
        <button type="button" class="voltar" onclick="history.back()">
          <svg class="ico" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
          <span>Voltar</span>
        </button>
      </a>
    </div>

    <main class="page-wrap" role="main">
      
      <header class="page-head">
        <div style="display:flex; justify-content:space-between; align-items:start; flex-wrap:wrap; gap:1rem;">
          <div>
            <h1 class="title">
              Devolução <span id="dv-id" class="kbd" aria-live="polite"></span>
            </h1>
            <div class="stepper-wrap" style="width: 300px; margin: 1rem 0 0 0;">
               <div class="step">Criada</div>
               <div class="step active">Em Processo</div>
               <div class="step">Finalizada</div>
            </div>
          </div>

          <div class="actions">
             <button id="btn-enrich" class="btn btn--ghost" type="button">
                <svg class="btn__icon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/></svg>
                <span>Atualizar (ML)</span>
             </button>
             
             <div class="mark-wrap">
                <select id="mark-op" class="select-lg" title="Marcar como">
                  <option value="em_espera" selected>Em espera</option>
                  <option value="concluida">Concluída</option>
                  <option value="defeituosa">Defeituosa</option>
                </select>
                <input id="mark-obs" type="text" class="input-lg" placeholder="Obs. rápida..." style="max-width:150px;" />
                <button id="btn-mark" class="btn btn--success" type="button">Aplicar</button>
             </div>
          </div>
        </div>
      </header>

      <div class="grid-layout">
        
        <aside class="area-sidebar">
          <section class="card card-static" aria-labelledby="sec-resumo">
            <h2 id="sec-resumo" style="font-size:1rem; color:#64748b; text-transform:uppercase; letter-spacing:0.5px;">Resumo do Pedido</h2>
            
            <div class="row">
              <label style="font-size:0.75rem;">Cliente</label>
              <input id="cliente_nome" name="cliente_nome" type="text" class="input-static" readonly placeholder="Carregando..." />
            </div>

            <div class="row">
              <label style="font-size:0.75rem;">Número do Pedido / ID</label>
              <input id="id_venda" name="id_venda" type="text" class="input-static" readonly placeholder="—" />
              <input id="order_id" name="order_id" type="hidden" /> <input id="ml_claim_id" name="ml_claim_id" type="hidden" />
            </div>

            <div class="row">
              <label style="font-size:0.75rem;">Loja</label>
              <input id="loja_nome" name="loja_nome" type="text" class="input-static" readonly placeholder="—" />
            </div>

            <div class="row">
              <label style="font-size:0.75rem;">SKU</label>
              <input id="sku" name="sku" type="text" class="input-static font-mono" readonly placeholder="—" />
            </div>

            <div class="total-line">
              <label style="font-size:0.75rem;">Data Compra</label>
              <input id="data_compra" name="data_compra" type="date" class="input-static" readonly />
            </div>
            
            <div class="row" style="margin-top:1rem; border-top:1px solid #e2e8f0; padding-top:1rem;">
               <label for="nfe_chave" style="font-size:0.75rem;">Nota Fiscal (Chave)</label>
               <input id="nfe_chave" name="nfe_chave" type="text" placeholder="Insira a chave..." style="font-size:0.8rem;" />
               <input id="nfe_numero" name="nfe_numero" type="hidden" />
            </div>
          </section>
        </aside>

        <div class="area-main" style="display:flex; flex-direction:column; gap:1.5rem;">
          
          <section class="card">
            <h2>Status & Classificação</h2>
            
            <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 1.5rem;">
              <div class="row">
                <label for="status">Status Interno</label>
                <select id="status" name="status" class="input-lg" style="border-color:var(--primary);">
                  <option value="">— Selecione —</option>
                  <option value="pendente">Pendente</option>
                  <option value="em_analise">Em análise</option>
                  <option value="aprovado">Aprovado</option>
                  <option value="rejeitado">Rejeitado</option>
                  <option value="cancelado">Cancelado</option>
                </select>
                
                <div class="ml-badge-group">
                   <span class="ml-label">Status no Mercado Livre:</span>
                   <input id="ml_status_real" type="text" class="input-static" readonly placeholder="—" style="color:#0369a1; font-size:0.9rem;" />
                </div>
              </div>

              <div class="row">
                <label for="tipo_reclamacao">Motivo da Reclamação</label>
                <select id="tipo_reclamacao" name="tipo_reclamacao">
                  <option value="">—</option>
                  <option value="produto_defeituoso">Produto defeituoso</option>
                  <option value="produto_danificado">Produto danificado</option>
                  <option value="nao_corresponde">Não corresponde à descrição</option>
                  <option value="arrependimento_cliente">Arrependimento</option>
                  <option value="entrega_atrasada">Entrega atrasada</option>
                </select>

                <div class="ml-badge-group" style="background:#fff7ed; border-color:#ffedd5;">
                   <span class="ml-label" style="color:#c2410c;">Cliente alegou (ML):</span>
                   <input id="ml_motivo_real" type="text" class="input-static" readonly placeholder="—" style="color:#9a3412; font-size:0.9rem;" />
                </div>
              </div>
            </div>
          </section>

          <section class="card">
            <div style="display:flex; justify-content:space-between;">
              <h2>Conferência & Logística</h2>
              <span id="pill-log" class="pill -neutro">Logística Pendente</span>
            </div>

            <div class="grid" style="grid-template-columns: 1fr 1fr 1fr; gap:1rem;">
               <div class="row">
                 <label for="valor_produto">Produto (R$)</label>
                 <input id="valor_produto" name="valor_produto" type="text" placeholder="0,00" />
               </div>
               <div class="row">
                 <label for="valor_frete">Frete (R$)</label>
                 <input id="valor_frete" name="valor_frete" type="text" placeholder="0,00" />
               </div>
               <div class="row">
                 <label>Total Reembolso</label>
                 <input id="valor_total" name="valor_total" type="text" class="input-readonly" readonly />
               </div>
            </div>

            <div class="cta-box">
               <div>
                 <strong>Chegou no CD?</strong>
                 <p style="font-size:0.85rem; color:#15803d; margin-top:2px;" id="cd-info-text">
                   <span id="pill-cd">Não registrado</span> 
                   <span id="cd-resp" hidden></span> <span id="cd-when" hidden></span>
                 </p>
               </div>
               <button type="button" class="btn btn--success btn--lg" id="btn-cd">
                 <svg class="btn__icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                 <span>Registrar Chegada</span>
               </button>
            </div>
          </section>

          <section class="card">
            <h2>Observações</h2>
            <textarea id="reclamacao" name="reclamacao" rows="3" placeholder="Anotações internas..."></textarea>
          </section>
          
          <section class="card">
             <h2 style="font-size:1rem;">Histórico de Eventos</h2>
             <div id="events-loading">Carregando…</div>
             <div id="events-empty" hidden>Nenhum evento ainda</div>
             <div id="events-list" class="timeline"></div>
          </section>

        </div> </div> <footer class="page-footer">
        <div class="footer-actions">
           <span style="margin-right:auto; font-size:0.8rem; color:#64748b;">
             Use <strong>Ctrl+S</strong> para salvar rápido
           </span>
          <button type="button" class="btn btn--ghost btn--lg" onclick="history.back()">Cancelar</button>
          <button id="btn-salvar" class="btn btn--primary btn--lg" type="button">
            <svg class="btn__icon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
            <span>Salvar Alterações</span>
          </button>
        </div>
      </footer>

    </main>

    <div id="toast" class="toast" aria-live="polite"></div>
    
    <dialog id="dlg-recebido" class="dialog" aria-labelledby="rcd-title">
        <form method="dialog" id="rcd-form" class="dialog-body">
          <h3 id="rcd-title">Recebimento no CD</h3>
          <p class="dialog-desc">Registre a chegada do pacote.</p>
          <div class="dialog-grid" style="grid-template-columns:1fr 1fr; gap:12px;">
            <div>
              <label for="rcd-resp">Quem recebeu?</label>
              <input id="rcd-resp" type="text" placeholder="Ex.: João" required />
            </div>
            <div>
              <label for="rcd-when">Horário</label>
              <input id="rcd-when" type="datetime-local" required />
            </div>
            <div style="grid-column:1 / -1;">
              <label for="rcd-ok">Conferência física:</label>
              <select id="rcd-ok" required>
                <option value="" disabled selected>Selecione o resultado...</option>
                <option value="sim">✅ Tudo certo (Item correto e íntegro)</option>
                <option value="nao">❌ Problema (Item errado, quebrado ou vazio)</option>
              </select>
              <small id="rcd-help" style="display:block;opacity:.8;margin-top:6px; color:#eab308;"></small>
            </div>
          </div>
          <div class="dialog-actions">
            <button type="button" class="btn btn--ghost" id="rcd-cancel">Cancelar</button>
            <button id="rcd-confirm" type="submit" class="btn btn--primary">Confirmar</button>
          </div>
        </form>
    </dialog>

  </div>

  <script src="js/devolucao-editar.js"></script>
</body>
</html>