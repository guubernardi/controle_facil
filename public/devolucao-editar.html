<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Devoluções - Mercado Livre</title>
  <meta name="description" content="Sistema de gerenciamento de devoluções - Edição e controle de processos de devolução do Mercado Livre">
  <link rel="stylesheet" href="css/devolucao.css">
</head>
<body>
  <div class="min-h-screen">
    <!-- Header -->
    <header class="header">
      <div class="container">
        <div class="header-top">
          <a href="index.html">
            <button class="btn btn-ghost" onclick="window.history.back()">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
              </svg>
              Voltar
            </button>
          </a>
          <div class="header-actions">
            <button class="btn btn-outline" onclick="handleEnrich()">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
              </svg>
              Atualizar dados (ML)
            </button>
            <button class="btn btn-success" onclick="handleSave()">
              <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
              </svg>
              Salvar
            </button>
          </div>
        </div>

        <div class="header-title">
          <h1>Devolução <span class="return-id" id="returnIdHeader">#672932</span></h1>
        </div>

        <p class="rules-text">
          <strong>Regras:</strong> Rejeitado = R$ 0,00 · Motivo do cliente = R$ 0,00 · Recebido no CD/Inspeção = só frete
        </p>

        <!-- Action Bar -->
        <div class="action-bar">
          <select class="select" id="markStatus">
            <option value="em_espera">Em espera</option>
            <option value="concluida">Concluída</option>
            <option value="defeituosa">Defeituosa</option>
            <option value="troca">Troca</option>
            <option value="reembolso_parcial">Reembolso parcial</option>
          </select>

          <input 
            type="text" 
            class="input" 
            id="markObservation" 
            placeholder="Observação (opcional)"
          />

          <button class="btn btn-default" onclick="handleMark()">
            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            Aplicar
          </button>
        </div>
      </div>
    </header>

    <main class="container main-content">
      <div class="grid">
        <!-- Dados da Devolução -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Dados da Devolução</h3>
          </div>
          <div class="card-content">
            <div class="form-group">
              <label for="orderId">Número do Pedido</label>
              <input type="text" class="input input-mono" id="orderId" value="LU-148447077863929" placeholder="Ex.: 12345 / TESTE-001">
            </div>

            <div class="form-group">
              <label for="customerName">Cliente</label>
              <input type="text" class="input" id="customerName" value="Ivair flores oliveira" placeholder="Nome do cliente">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="storeName">Loja</label>
                <input type="text" class="input" id="storeName" value="Magalu - Meta Parts" placeholder="Nome da loja">
              </div>

              <div class="form-group">
                <label for="purchaseDate">Data da compra</label>
                <input type="date" class="input" id="purchaseDate" value="2025-11-06">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="status">Status (interno)</label>
                <select class="select" id="status">
                  <option value="pendente">Pendente</option>
                  <option value="em_analise" selected>Em análise</option>
                  <option value="aprovado">Aprovado</option>
                  <option value="rejeitado">Rejeitado</option>
                  <option value="cancelado">Cancelado</option>
                </select>
              </div>

              <div class="form-group">
                <label for="reason">Motivo da reclamação</label>
                <select class="select" id="reason">
                  <option value="produto_defeituoso" selected>Produto defeituoso</option>
                  <option value="produto_danificado">Produto danificado</option>
                  <option value="nao_corresponde">Não corresponde à descrição</option>
                  <option value="arrependimento_cliente">Arrependimento do cliente</option>
                  <option value="entrega_atrasada">Entrega atrasada</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="sku">SKU / Item ID</label>
              <input type="text" class="input input-mono" id="sku" value="KITF0190" placeholder="Ex.: SKU-12345">
            </div>
          </div>
        </div>

        <!-- Valores -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Valores</h3>
          </div>
          <div class="card-content">
            <div class="form-group">
              <label for="productValue">Valor do Produto</label>
              <input type="number" class="input input-mono" id="productValue" value="121.35" step="0.01">
            </div>

            <div class="form-group">
              <label for="shippingValue">Valor do Frete</label>
              <input type="number" class="input input-mono" id="shippingValue" value="15.00" step="0.01">
            </div>

            <div class="separator"></div>

            <div class="form-group">
              <label for="totalValue">Valor Total a Reembolsar</label>
              <input type="text" class="input input-mono total-value" id="totalValue" readonly>
            </div>

            <div class="separator"></div>

            <!-- Status Box -->
            <div class="status-box">
              <div class="status-row">
                <span class="status-label">Status da Logística</span>
                <span class="badge badge-secondary" id="logStatusBadge">Em caminho</span>
              </div>

              <div class="status-row">
                <span class="status-label">Recebimento no CD</span>
                <button class="btn btn-outline btn-sm" onclick="openCdDialog()">
                  <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                  </svg>
                  Gerenciar
                </button>
              </div>

              <div id="cdReceivedInfo" class="cd-info" style="display: none;">
                <span class="badge badge-default">Recebido no CD</span>
                <span>·</span>
                <span>Resp.: <span id="cdResponsibleText"></span></span>
                <span>·</span>
                <span id="cdDateTimeText"></span>
              </div>

              <div class="status-row inspection-row">
                <span class="status-label">Inspeção</span>
                <div class="inspection-buttons">
                  <button class="btn btn-success btn-sm" onclick="openInspectionDialog('approve')">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
                    </svg>
                    Aprovar
                  </button>
                  <button class="btn btn-destructive btn-sm" onclick="openInspectionDialog('reject')">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.096c.5 0 .905-.405.905-.904 0-.715.211-1.413.608-2.008L17 13V4m-7 10h2m5-10h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5"/>
                    </svg>
                    Reprovar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Nota Fiscal -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Nota Fiscal</h3>
          </div>
          <div class="card-content">
            <div class="form-group">
              <label for="invoiceNumber">Número da NF-e</label>
              <input type="text" class="input" id="invoiceNumber" placeholder="Ex.: 12345">
            </div>

            <div class="form-group">
              <label for="invoiceKey">Chave de acesso (44 dígitos)</label>
              <input type="text" class="input input-mono" id="invoiceKey" placeholder="35240112345678901234567890123456789012345678" maxlength="44">
            </div>
          </div>
        </div>

        <!-- Observações -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Observações</h3>
          </div>
          <div class="card-content">
            <div class="form-group">
              <label for="notes">Detalhes da reclamação</label>
              <textarea class="textarea" id="notes" rows="6" placeholder="Descreva o motivo da devolução..."></textarea>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- CD Dialog -->
  <div class="dialog-overlay" id="cdDialog" style="display: none;">
    <div class="dialog-content">
      <div class="dialog-header">
        <h3 class="dialog-title">Recebido no CD</h3>
        <button class="dialog-close" onclick="closeCdDialog()">×</button>
      </div>
      <p class="dialog-description">Registre quando o produto foi recebido no centro de distribuição.</p>
      <div class="dialog-body">
        <div class="form-group">
          <label for="cdResponsible">Responsável</label>
          <input type="text" class="input" id="cdResponsible" placeholder="Ex.: João (CD)">
        </div>
        <div class="form-group">
          <label for="cdDateTime">Data/Hora</label>
          <input type="datetime-local" class="input" id="cdDateTime">
        </div>
        <p class="dialog-hint">
          Dica: se deixar o responsável vazio, será usado <strong>cd</strong>. Se não escolher uma data, uso a data/hora atual.
        </p>
      </div>
      <div class="dialog-footer">
        <button class="btn btn-outline" onclick="closeCdDialog()">Cancelar</button>
        <button class="btn btn-default" onclick="handleCdSave()">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Inspection Dialog -->
  <div class="dialog-overlay" id="inspectionDialog" style="display: none;">
    <div class="dialog-content">
      <div class="dialog-header">
        <h3 class="dialog-title">Inspeção</h3>
        <button class="dialog-close" onclick="closeInspectionDialog()">×</button>
      </div>
      <p class="dialog-description" id="inspectionDescription"></p>
      <div class="dialog-body">
        <div class="form-group">
          <label for="inspectionNotes">Observação (opcional)</label>
          <textarea class="textarea" id="inspectionNotes" rows="4" placeholder="Adicione detalhes sobre a inspeção..."></textarea>
        </div>
      </div>
      <div class="dialog-footer">
        <button class="btn btn-outline" onclick="closeInspectionDialog()">Cancelar</button>
        <button class="btn btn-default" onclick="handleInspectionConfirm()">Confirmar</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container"></div>

  <script src="js/devolucao-editar.js"></script>
</body>
</html>
